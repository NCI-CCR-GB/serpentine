rule bam_measure_insert_size:
    input:
        "{prefix}.sorted.bam"
    output:
        txt="{prefix}.insert_size.txt",
        pdf="{prefix}.insert_size_histogram.pdf"
    shell:
        "picard-tools CollectInsertSizeMetrics INPUT={input} "
        "OUTPUT={output.txt} HISTOGRAM_FILE={output.pdf}"


rule collectrnaseqmetrics:
    input: bam="{base}.bam",
           refflat=CONFIG['refFlat'],
           ribosomal=CONFIG['ribosomal'],
           reference=CONFIG['fasta']
    output: "{base}.bam.rnametrics"
    params: batch="-l nodes=1:gpfs -q ccr"
    version: "1.119"
    shell: 
        "module load picard/1.119 && "
        "java -jar $PICARDJARPATH/CollectRnaSeqMetrics.jar "
        "R={input.reference} I={input.bam} "
        "O={output} AS=true LEVEL=READ_GROUP LEVEL=SAMPLE LEVEL=LIBRARY "
        "REF_FLAT={input.refflat} STRAND_SPECIFICITY=NONE "
        "RIBOSOMAL_INTERVALS={input.ribosomal}"

